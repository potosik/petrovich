/*!
* jQuery Smart Cart v3.0.1
* The smart interactive jQuery Shopping Cart plugin with PayPal payment support
* http://www.techlaboratory.net/smartcart
*
* Created by Dipu Raj
* http://dipuraj.me
*
* Licensed under the terms of the MIT License
* https://github.com/techlab/SmartCart/blob/master/LICENSE
*/
(function(n,t,i,r){"use strict";function u(t,i){this.options=n.extend(!0,{},f,i);this.cart=[];this.cart_element=n(t);this.init()}var f={cart:[],resultName:"cart_list",theme:"default",combineProducts:!1,highlightEffect:!0,cartItemTemplate:'<img class="img-responsive pull-left" src="{product_image}" /><h5 class="list-group-item-heading">{product_name}<\/h5><hr /><p class="list-group-item-text">{product_desc}<\/p>',cartItemQtyTemplate:"{display_price} × {display_quantity} = {display_amount}",productContainerSelector:".sc-product-item",productElementSelector:"*",addCartSelector:".sc-add-to-cart",paramSettings:{productPrice:"product_price",productQuantity:"product_quantity",productName:"product_name",productId:"product_id"},lang:{cartTitle:"Заявка",checkout:"Оформить",clear:"Очистить",subtotal:"Всего:",cartRemove:"×",cartEmpty:"Нет выбранных элементов"},submitSettings:{submitType:"form",ajaxURL:"",ajaxSettings:{}},currencySettings:{locales:"ru-RU",currencyOptions:{style:"currency",currency:"BYN",currencyDisplay:"code"}},toolbarSettings:{showToolbar:!0,showCheckoutButton:!0,showClearButton:!0,showCartSummary:!0,checkoutButtonStyle:"default",checkoutButtonImage:"",toolbarExtraButtons:[]},debug:!1};n.extend(u.prototype,{init:function(){this._setElements();this._setToolbar();this._setEvents();var t=this;n(this.options.cart).each(function(n,i){i=t._addToCart(i)});this._hasCartChange()},_setElements:function(){var t=n('<input type="hidden" name="'+this.options.resultName+'" id="'+this.options.resultName+'" />');this.cart_element.append(t);this.cart_element.addClass("sc-cart sc-theme-"+this.options.theme);this.cart_element.append('<a href="javascript:;" class="dropdown-toggle info-number" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-shopping-cart"><\/i><span class="bg-green sc-cart-count badge">0<\/span>&nbsp;<\/a>');this.cart_element.append('<div class="dropdown-menu dropdown-bidmenu pull-right"><div class="sc-cart-item-list"><\/div><\/div>')},_setToolbar:function(){var t,e,u;if(this.options.toolbarSettings.showToolbar!==!0)return!1;var r=n("<div><\/div>").addClass("panel-footer sc-toolbar"),i=n('<div class="sc-cart-toolbar">'),f=n('<div class="sc-cart-summary">');if(this.options.toolbarSettings.showCheckoutButton){t="";switch(this.options.toolbarSettings.checkoutButtonStyle){case"paypal":t='<button class="sc-button-checkout-paypal sc-cart-checkout" type="submit"><img src="https://www.paypalobjects.com/webstatic/en_US/i/buttons/checkout-logo-medium.png" alt="Check out with PayPal" /><\/button>';break;case"image":t='<button class="sc-button-checkout-paypal sc-cart-checkout" type="submit"><img src="'+this.options.toolbarSettings.checkoutButtonImage+'" alt="Check out" /><\/button>';break;default:t='<button class="btn btn-info sc-cart-checkout" type="button">'+this.options.lang.checkout+"<\/button> "}i.append(t)}this.options.toolbarSettings.showClearButton&&(e=n('<button class="btn btn-danger sc-cart-clear" type="button">').text(this.options.lang.clear),i.append(e));this.options.toolbarSettings.toolbarExtraButtons&&this.options.toolbarSettings.toolbarExtraButtons.length>0&&i.append(this.options.toolbarSettings.toolbarExtraButtons);this.options.toolbarSettings.showCartSummary&&(u=n('<div class="sc-cart-summary-subtotal">'),u.append(this.options.lang.subtotal).append(' <span class="sc-cart-subtotal">0<\/span>'),f.append(u));r.append(f);r.append(i);this.cart_element.find(".dropdown-menu").append(r)},_setEvents:function(){var t=this;n(this.options.addCartSelector).on("click",function(i){i.preventDefault();var r=t._getProductDetails(n(this));r=t._addToCart(r);n(this).parents(t.options.productContainerSelector).addClass("sc-added-item").attr("data-product-unique-key",r.unique_key)});n(this.cart_element).on("click",".sc-cart-remove",function(i){i.preventDefault();n(this).parents(".sc-cart-item").fadeOut("normal",function(){t._removeFromCart(n(this).data("unique-key"));n(this).remove();t._hasCartChange()})});n(this.cart_element).on("change",".sc-cart-item-qty",function(i){i.preventDefault();t._updateCartQuantity(n(this).parents(".sc-cart-item").data("unique-key"),n(this).val())});n(this.cart_element).on("click",".sc-cart-checkout",function(i){if(n(this).hasClass("disabled"))return!1;i.preventDefault();t._submitCart()});n(this.cart_element).on("click",".sc-cart-clear",function(i){if(n(this).hasClass("disabled"))return!1;i.preventDefault();n(".sc-cart-item-list > .sc-cart-item",this.cart_element).fadeOut("normal",function(){n(this).remove();t._clearCart();t._hasCartChange()})})},_getProductDetails:function(t){var u=this,i={};return t.parents(this.options.productContainerSelector).find(this.options.productElementSelector).each(function(){if(n(this).is("[name]")===!0||typeof n(this).data("name")!=typeof r){var t=n(this).attr("name")?n(this).attr("name"):n(this).data("name"),f=u._getContent(n(this));t&&f&&(i[t]=f)}}),i},_addToCart:function(t){var u=this,r,i;return t.hasOwnProperty(this.options.paramSettings.productPrice)?(t.hasOwnProperty(this.options.paramSettings.productQuantity)||(this._logMessage("Quantity not found, default to 1"),t[this.options.paramSettings.productQuantity]=1),t.hasOwnProperty("unique_key")||(t.unique_key=this._getUniqueKey()),this.options.combineProducts?(r=n.grep(this.cart,function(n){return u._isObjectsEqual(n,t)}),r.length>0?(i=this.cart.indexOf(r[0]),this.cart[i][this.options.paramSettings.productQuantity]=this.cart[i][this.options.paramSettings.productQuantity]-0+(t[this.options.paramSettings.productQuantity]-0),t=this.cart[i],this._triggerEvent("itemUpdated",[t])):(this.cart.push(t),this._triggerEvent("itemAdded",[t]))):(this.cart.push(t),this._triggerEvent("itemAdded",[t])),this._addUpdateCartItem(t),t):(this._logError("Price is not set for the item"),!1)},_removeFromCart:function(t){var i=this;n.each(this.cart,function(r,u){if(u.unique_key===t){var f=i.cart[r];return i.cart.splice(r,1),n('*[data-product-unique-key="'+t+'"]').removeClass("sc-added-item"),i._hasCartChange(),i._triggerEvent("itemRemoved",[f]),!1}})},_clearCart:function(){this.cart=[];this._triggerEvent("cartCleared");this._hasCartChange()},_updateCartQuantity:function(t,i){var r=this,u=this._getValidateNumber(i);n.each(this.cart,function(n,f){if(f.unique_key===t)return u&&(r.cart[n][r.options.paramSettings.productQuantity]=i),r._addUpdateCartItem(r.cart[n]),r._triggerEvent("quantityUpdated",[r.cart[n],i]),!1})},_addUpdateCartItem:function(t){var u=(t[this.options.paramSettings.productQuantity]-0)*(t[this.options.paramSettings.productPrice]-0),f=n(".sc-cart-item-list",this.cart_element),i=f.find("[data-unique-key='"+t.unique_key+"']"),r;i&&i.length>0?(i.find(".sc-cart-item-qty").val(t[this.options.paramSettings.productQuantity]),i.find(".sc-cart-item-amount").text(this._getMoneyFormatted(u))):(i=n("<div><\/div>").addClass("sc-cart-item list-group-item"),i.append('<button type="button" class="sc-cart-remove">'+this.options.lang.cartRemove+"<\/button>"),i.attr("data-unique-key",t.unique_key),i.append(this._formatTemplate(this.options.cartItemTemplate,t)),r='<div class="sc-cart-item-summary"><span class="sc-cart-item-price">'+this._getMoneyFormatted(t[this.options.paramSettings.productPrice])+"<\/span>",r+=' × <input type="number" min="1" max="1000" class="sc-cart-item-qty" value="'+this._getValueOrEmpty(t[this.options.paramSettings.productQuantity])+'" />',r+=' = <span class="sc-cart-item-amount">'+this._getMoneyFormatted(u)+"<\/span><\/div>",i.append(r),f.append(i));this.options.highlightEffect===!0&&(i.addClass("sc-highlight"),setTimeout(function(){i.removeClass("sc-highlight")},500));this._hasCartChange()},_hasCartChange:function(){n(".sc-cart-count",this.cart_element).text(this.cart.length);n(".sc-cart-subtotal",this.element).text(this._getCartSubtotal());this.cart.length===0?(n(".sc-cart-item-list",this.cart_element).empty().append(n('<div class="sc-cart-empty-msg">'+this.options.lang.cartEmpty+"<\/div>")),n(this.options.productContainerSelector).removeClass("sc-added-item"),n(".sc-cart-checkout, .sc-cart-clear").addClass("disabled"),this._triggerEvent("cartEmpty")):(n(".sc-cart-item-list > .sc-cart-empty-msg",this.cart_element).remove(),n(".sc-cart-checkout, .sc-cart-clear").removeClass("disabled"));n("#"+this.options.resultName,this.cart_element).val(JSON.stringify(this.cart))},_getCartSubtotal:function(){var t=this,i=0;return n.each(this.cart,function(n,r){t._getValidateNumber(r[t.options.paramSettings.productPrice])&&(i+=(r[t.options.paramSettings.productPrice]-0)*(r[t.options.paramSettings.productQuantity]-0))}),this._getMoneyFormatted(i)},_submitCart:function(){var t=this,i=this.cart_element.parents("form"),r,u;if(!i)return this._logError("Form not found to submit"),!1;switch(this.options.submitSettings.submitType){case"ajax":r=this.options.submitSettings.ajaxURL&&this.options.submitSettings.ajaxURL.length>0?this.options.submitSettings.ajaxURL:i.attr("action");u=n.extend(!0,{},{url:r,type:"POST",data:i.serialize(),beforeSend:function(){t.cart_element.addClass("loading")},error:function(n,i,r){t.cart_element.removeClass("loading");t._logError(r)},success:function(){t.cart_element.removeClass("loading");t._triggerEvent("cartSubmitted",[t.cart]);t._clearCart()}},this.options.submitSettings.ajaxSettings);n.ajax(u);break;case"paypal":i.children(".sc-paypal-input").remove();n.each(this.cart,function(n,r){var u=n+1;i.append('<input class="sc-paypal-input" name="item_number_'+u+'" value="'+t._getValueOrEmpty(r[t.options.paramSettings.productId])+'" type="hidden">').append('<input class="sc-paypal-input" name="item_name_'+u+'" value="'+t._getValueOrEmpty(r[t.options.paramSettings.productName])+'" type="hidden">').append('<input class="sc-paypal-input" name="amount_'+u+'" value="'+t._getValueOrEmpty(r[t.options.paramSettings.productPrice])+'" type="hidden">').append('<input class="sc-paypal-input" name="quantity_'+u+'" value="'+t._getValueOrEmpty(r[t.options.paramSettings.productQuantity])+'" type="hidden">')});i.submit();this._triggerEvent("cartSubmitted",[this.cart]);break;default:i.submit();this._triggerEvent("cartSubmitted",[this.cart])}return!0},_getContent:function(n){return n.is(":checkbox, :radio")?n.is(":checked")?n.val():"":n.is("[value], select")?n.val():n.is("img")?n.attr("src"):n.text()},_isObjectsEqual:function(n,t){if(Object.getOwnPropertyNames(n).length!==Object.getOwnPropertyNames(t).length)return!1;for(var i in n)if(i!=="unique_key"&&i!==this.options.paramSettings.productQuantity&&(typeof n[i]!=typeof r||typeof t[i]!=typeof r)&&n[i]!==t[i])return!1;return!0},_getMoneyFormatted:function(n){return n=+n,Number(n.toFixed(2)).toLocaleString(this.options.currencySettings.locales,this.options.currencySettings.currencyOptions)},_getValueOrEmpty:function(n){return n&&typeof n!=typeof r?n:""},_getValidateNumber:function(n){return(n=+n,n&&n>0)?!0:!1},_formatTemplate:function(n,t){for(var u,r=n.split("{"),f="",i=0;i<r.length;i++)u=r[i].substring(0,r[i].indexOf("}")),f+=u.length>0?r[i].replace(u+"}",this._getValueOrEmpty(t[u])):r[i];return f},_triggerEvent:function(t,i){var r=n.Event(t);return(this.cart_element.trigger(r,i),r.isDefaultPrevented())?!1:r.result},_getUniqueKey:function(){var n=new Date;return n.getTime()},_logMessage:function(n){if(this.options.debug!==!0)return!1;console.log(n)},_logError:function(t){if(this.options.debug!==!0)return!1;n.error(t)},submit:function(){this._submitCart()},clear:function(){this._clearCart()}});n.fn.smartCart=function(t){var f=arguments,i;return t===r||typeof t=="object"?this.each(function(){n.data(this,"smartCart")||n.data(this,"smartCart",new u(this,t))}):typeof t=="string"&&t[0]!=="_"&&t!=="init"?(i=n.data(this[0],"smartCart"),t==="destroy"&&n.data(this,"smartCart",null),i instanceof u&&typeof i[t]=="function"?i[t].apply(i,Array.prototype.slice.call(f,1)):this):void 0}})(jQuery,window,document);